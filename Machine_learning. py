import chromadb

# Connect to ChromaDB (Persistent Storage)
chroma_client = chromadb.PersistentClient(path="./chroma_db")

# Manually list collection names
collection_names = [col.name for col in chroma_client.list_collections()]

if not collection_names:
    print("❌ No collections found in ChromaDB.")
    exit()

print("📂 **Available Collections:**")
for name in collection_names:
    print(f"- {name}")

print("\n📜 **Full Schema Dump**")
print("=" * 50)

# Iterate over each collection
for name in collection_names:
    print(f"\n🔍 **Collection: {name}**")
    print("-" * 50)

    # Load collection
    col = chroma_client.get_collection(name=name)

    # Fetch all data (Documents, Metadata, Embeddings)
    data = col.get(include=["documents", "metadatas", "embeddings"], limit=5)  # Limit to 5 for preview

    # Print total records (if available)
    total_records = len(data.get("documents", []))
    print(f"📊 Total Records: {total_records}")

    # Print example schema from the first record (if available)
    if total_records > 0:
        print("\n📝 **Schema Example:**")
        print(f"🔹 **Document Sample:** {data['documents'][0]}")
        print(f"🔹 **Metadata Sample:** {data['metadatas'][0]}")
        print(f"🔹 **Embedding Sample (First 5 values):** {data['embeddings'][0][:5]} ...")

    print("=" * 50)