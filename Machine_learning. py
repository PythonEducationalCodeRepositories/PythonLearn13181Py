from reportlab.lib.pagesizes import letter
from reportlab.pdfgen import canvas
from reportlab.lib import colors
from reportlab.lib.units import inch
from reportlab.platypus import Paragraph, Frame
from reportlab.lib.styles import getSampleStyleSheet

def create_resume_pdf(output_pdf, name, contact_info, education, skills, filename):
    c = canvas.Canvas(output_pdf, pagesize=letter)
    width, height = letter

    # **Set Margins**
    margin_x = 50  # Left & Right Margin
    margin_y = 50  # Top & Bottom Margin
    usable_width = width - 2 * margin_x
    usable_height = height - 2 * margin_y

    # **Draw Border**
    c.setStrokeColor(colors.black)
    c.setLineWidth(2)
    c.rect(margin_x, margin_y, usable_width, usable_height)

    # **Set Title (Centered)**
    c.setFont("Helvetica-Bold", 18)
    c.drawCentredString(width / 2, height - 70, name)

    # **Add Contact Information**
    y_pos = height - 100
    c.setFont("Helvetica", 10)
    contact_details = f"Email: {', '.join(contact_info['email']) if contact_info['email'] else 'N/A'} | "
    contact_details += f"Phone: {', '.join(contact_info['phone']) if contact_info['phone'] else 'N/A'} | "
    contact_details += f"LinkedIn: {', '.join(contact_info['linkedin']) if contact_info['linkedin'] else 'N/A'}"
    
    # **Wrap Contact Info inside Border**
    styles = getSampleStyleSheet()
    contact_para = Paragraph(contact_details, styles["Normal"])
    contact_frame = Frame(margin_x, y_pos - 30, usable_width, 20, showBoundary=0)
    contact_frame.addFromList([contact_para], c)

    # **Draw a Line Separator**
    c.line(margin_x, y_pos - 40, width - margin_x, y_pos - 40)
    
    # **Education Section**
    y_pos -= 60
    c.setFont("Helvetica-Bold", 12)
    c.drawString(margin_x, y_pos, "Education:")
    c.setFont("Helvetica", 10)
    y_pos -= 15
    for edu in education:
        c.drawString(margin_x, y_pos, f"- {edu}")
        y_pos -= 15  # Move down

    # **Skills Section**
    y_pos -= 20
    c.setFont("Helvetica-Bold", 12)
    c.drawString(margin_x, y_pos, "Skills:")
    c.setFont("Helvetica", 10)
    y_pos -= 15

    # **Wrap Long Skills List Inside Border**
    skills_text = ", ".join(skills)
    skills_para = Paragraph(skills_text, styles["Normal"])
    skills_frame = Frame(margin_x, y_pos - 50, usable_width, 40, showBoundary=0)
    skills_frame.addFromList([skills_para], c)

    # **Add Source Filename at Bottom**
    c.setFont("Helvetica", 6)
    c.drawString(margin_x, margin_y + 10, f"Source File: {filename}")

    c.save()